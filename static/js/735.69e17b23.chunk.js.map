{"version":3,"file":"static/js/735.69e17b23.chunk.js","mappings":"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","sources":["pages/Libs/index.js"],"sourcesContent":["import { useMemo, useState, useRef } from 'react';\nimport { createWithRemoteLoader, useLoader } from '@kne/remote-loader';\nimport createEntry from '@kne/modules-dev/dist/create-entry';\nimport { useParams, Navigate } from 'react-router-dom';\nimport get from 'lodash/get';\nimport transform from 'lodash/transform';\nimport { withFetch } from '@kne/react-fetch';\nimport compose from '@kne/compose';\n\nconst Example = createEntry.Example;\n\nconst RemoteComponentsPage = compose(\n  withFetch,\n  createWithRemoteLoader({\n    modules: ['Filter@getFilterValue']\n  })\n)(({ remoteModules, data }) => {\n  const { libs, libsMap } = useMemo(() => {\n    const libs = data['libs'].map(item => {\n      return {\n        label: item.name,\n        value: item.name,\n        version: Object.keys(item.versions)\n          .sort((a, b) => {\n            return new Date(item.versions[b].time) - new Date(item.versions[a].time);\n          })\n          .map(key => {\n            return {\n              label: `v${key}`,\n              value: key\n            };\n          })\n      };\n    });\n    const libsMap = new Map(libs.map(item => [item.value, item]));\n    return { libs, libsMap };\n  }, [data]);\n\n  const [getFilterValue] = remoteModules;\n  const [filter, setFilter] = useState([]);\n\n  const { id: currentComponent } = useParams();\n  const filterValue = getFilterValue(filter);\n  const libNameRef = useRef(null);\n  const currentComponentNameRef = useRef(null);\n  const filterVersion = filterValue['version'];\n\n  const moduleTokens = useMemo(() => {\n    return libs.map(({ value, version }) => {\n      if (libNameRef.current === value) {\n        return `${value}/${filterVersion || get(version, '[0].value')}:components`;\n      }\n      return `${value}/${get(version, '[0].value')}:components`;\n    });\n  }, [libs, filterVersion]);\n\n  const {\n    loading,\n    error,\n    remoteModules: targetModules\n  } = useLoader({\n    modules: moduleTokens\n  });\n\n  const { components } = useMemo(() => {\n    if (loading || error) {\n      return {};\n    }\n    const libKeys = Array.from(libsMap.keys());\n    const components = transform(\n      targetModules,\n      (result, value, index) => {\n        Object.assign(\n          result,\n          transform(\n            value,\n            (result, value, key) => {\n              result[key] = Object.assign({}, value, { libKey: libKeys[index] });\n            },\n            {}\n          )\n        );\n      },\n      {}\n    );\n\n    const currentComponentName = (() => {\n      if (currentComponent && components[currentComponent]) {\n        libNameRef.current = components[currentComponent].libKey;\n        return currentComponent;\n      }\n\n      libNameRef.current = get(Object.values(components), '[0].libKey');\n\n      return get(Object.keys(components), '[0]');\n    })();\n\n    const version = (() => {\n      if (currentComponentNameRef.current !== currentComponentName) {\n        setFilter(filter => {\n          return filter.filter(({ name }) => name !== 'version');\n        });\n        currentComponentNameRef.current = currentComponentName;\n        return get(libsMap.get(components[currentComponentName].libKey), 'version[0].value');\n      }\n      return filterVersion || get(libsMap.get(components[currentComponentName].libKey), 'version[0].value');\n    })();\n\n    return { components, currentComponentName, version };\n  }, [loading, error, targetModules, filterVersion, currentComponent, libsMap]);\n\n  if (loading) {\n    return null;\n  }\n\n  if (error) {\n    return <Navigate to={`/error?msg=加载远程组件库可能不符合规范，您可以向开发者报告该问题`} replace />;\n  }\n\n  /*const { AdvancedSelectFilterItem } = fields;\n\n  const libKey = get(components, `${currentComponentName}.libKey`);*/\n\n  return (\n    <Example\n      baseUrl=\"/libs\"\n      readme={components}\n      pageProps={\n        {\n          /*filter: {\n                            value: filter, onChange: setFilter, list: [[<AdvancedSelectFilterItem\n                                label=\"版本\"\n                                name=\"version\"\n                                single\n                                api={{\n                                    data: libKey, loader: ({data}) => {\n                                        return {\n                                            pageData: get(libsMap.get(data), 'version', [])\n                                        };\n                                    }\n                                }}\n                            />]]\n                        }*/\n        }\n      }\n    />\n  );\n});\n\nconst Libs = createWithRemoteLoader({\n  modules: ['Global@usePreset']\n})(({ remoteModules }) => {\n  const [usePreset] = remoteModules;\n  const { apis } = usePreset();\n  return (\n    <RemoteComponentsPage\n      {...Object.assign({}, apis.manifest.getDetail, {\n        transformResponse: response => {\n          return { data: { code: 200, results: response.data } };\n        }\n      })}\n    />\n  );\n});\n\nexport default Libs;\n"],"names":["Example","createEntry","RemoteComponentsPage","compose","withFetch","createWithRemoteLoader","modules","_ref","remoteModules","data","libs","libsMap","useMemo","map","item","label","name","value","version","Object","keys","versions","sort","a","b","Date","time","key","concat","Map","getFilterValue","filter","setFilter","useState","id","currentComponent","useParams","filterValue","libNameRef","useRef","currentComponentNameRef","filterVersion","moduleTokens","_ref2","current","get","loading","error","targetModules","useLoader","components","libKeys","Array","from","transform","result","index","assign","libKey","currentComponentName","values","_ref3","_jsx","Navigate","to","replace","baseUrl","readme","pageProps","_ref4","usePreset","apis","manifest","getDetail","transformResponse","response","code","results"],"sourceRoot":""}