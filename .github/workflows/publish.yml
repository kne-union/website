name: Publish Website

on:
  push:
    branches:
      - master

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
      # 部署manifest文件
      - run: npx @kne/ued-manifest
      - run: mkdir -p ./website/ued-manifest  && cp -r ./build/* ./website/ued-manifest
      - run: rm -rf ./build
      - run: cd ./website && ls

      # 部署mini-core 小程序二维码
      - uses: actions/checkout@v4
        with:
          repository: 'kne-union/mini-core'
          ref: 'master'
      - run: npx @kne/miniprogram-tools qrcode
        env:
          APP_ID: wxae849489ee6c1994
          SECRET: ${{secrets.KNEUNION_SECRET}}
      #- run: mkdir -p ./website/mini-core && cp -r ./build/* ./website/mini-core
      - run: rm -rf ./build
      - run: cd ./website && ls
